{% extends "base.html" %}

{% block title %}Dashboard Commercial - E-Trans{% endblock %}

{% block css %}
<style>
  :root {
    --color-primary: #2c3e50;
    --color-secondary: #3498db;
    --color-success: #27ae60;
    --color-warning: #e67e22;
    --color-danger: #e74c3c;
    --color-info: #3498db;
    --color-star: #f1c40f;
    --border-radius: 10px;
    --box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
    --transition: all 0.3s ease;
  }

  .kpi-section {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 20px;
    margin-bottom: 30px;
  }

  .kpi-card {
    background: white;
    border-radius: var(--border-radius);
    padding: 25px;
    box-shadow: var(--box-shadow);
    border-left: 5px solid var(--color-primary);
    transition: var(--transition);
  }

  .kpi-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
  }

  .kpi-card.primary { border-left-color: var(--color-primary); }
  .kpi-card.info { border-left-color: var(--color-info); }
  .kpi-card.warning { border-left-color: var(--color-warning); }
  .kpi-card.success { border-left-color: var(--color-success); }

  .kpi-icon {
    font-size: 2.5rem;
    margin-bottom: 15px;
  }

  .kpi-value {
    font-size: 2.8rem;
    font-weight: 700;
    margin: 10px 0 5px;
  }

  .kpi-label {
    font-size: 1rem;
    color: #666;
    font-weight: 500;
  }

  .kpi-sublabel {
    font-size: 0.85rem;
    color: #999;
    margin-top: 5px;
  }

  .welcome-section {
    margin-bottom: 30px;
  }

  .welcome-section h1 {
    color: var(--color-primary);
    font-size: 2rem;
    margin-bottom: 10px;
  }

  .name-highlight {
    color: var(--color-secondary);
    font-weight: 600;
  }

  .stars {
    display: inline-flex;
    gap: 3px;
    margin-left: 5px;
  }

  .star {
    color: var(--color-star);
  }

  .chart-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 20px;
    margin-top: 20px;
  }

  .chart-container {
    background: white;
    border-radius: var(--border-radius);
    box-shadow: var(--box-shadow);
    padding: 25px;
  }

  .chart-header {
    font-size: 1.2rem;
    color: var(--color-primary);
    font-weight: 600;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .chart-content {
    height: 300px;
  }
</style>
{% endblock %}

{% block content %}
<div class="welcome-section">
  <h1>
    Bienvenue <span class="name-highlight">{{ current_user.username }}</span>
    <span class="stars">
      <i class="fas fa-star star"></i>
      <i class="fas fa-star star"></i>
      <i class="fas fa-star star"></i>
    </span>
  </h1>
  <p style="color: #666; font-size: 1.1rem;">
    <i class="fas fa-briefcase"></i> Dashboard Commercial - Vue d'ensemble des activités
  </p>
</div>

<div class="kpi-section">
  <div class="kpi-card primary">
    <div class="kpi-icon">
      <i class="fas fa-folder" style="color: var(--color-primary);"></i>
    </div>
    <div class="kpi-value" id="kpi-total">-</div>
    <div class="kpi-label">Total Dossiers</div>
    <div class="kpi-sublabel">Tous les dossiers actifs</div>
  </div>

  <div class="kpi-card info">
    <div class="kpi-icon">
      <i class="fas fa-box" style="color: var(--color-info);"></i>
    </div>
    <div class="kpi-value" id="kpi-fcl">-</div>
    <div class="kpi-label">Dossiers FCL</div>
    <div class="kpi-sublabel">Conteneurs complets</div>
  </div>

  <div class="kpi-card warning">
    <div class="kpi-icon">
      <i class="fas fa-boxes" style="color: var(--color-warning);"></i>
    </div>
    <div class="kpi-value" id="kpi-lcl">-</div>
    <div class="kpi-label">Dossiers LCL</div>
    <div class="kpi-sublabel">Groupage</div>
  </div>

  <div class="kpi-card success">
    <div class="kpi-icon">
      <i class="fas fa-paper-plane" style="color: var(--color-success);"></i>
    </div>
    <div class="kpi-value" id="kpi-sent">-</div>
    <div class="kpi-label">Avis Envoyés</div>
    <div class="kpi-sublabel">Ce mois-ci</div>
  </div>
</div>

<div class="chart-grid">
  <div class="chart-container">
    <div class="chart-header">
      <i class="fas fa-chart-line"></i>
      Évolution mensuelle
    </div>
    <div class="chart-content">
      <canvas id="monthlyChart"></canvas>
    </div>
  </div>

  <div class="chart-container">
    <div class="chart-header">
      <i class="fas fa-chart-pie"></i>
      Répartition FCL/LCL
    </div>
    <div class="chart-content">
      <canvas id="typeChart"></canvas>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script>
  async function loadData() {
    try {
      document.getElementById('kpi-total').textContent = '127';
      document.getElementById('kpi-fcl').textContent = '85';
      document.getElementById('kpi-lcl').textContent = '42';
      document.getElementById('kpi-sent').textContent = '98';
      
      const ctxMonthly = document.getElementById('monthlyChart').getContext('2d');
      new Chart(ctxMonthly, {
        type: 'line',
        data: {
          labels: ['Jan', 'Fév', 'Mar', 'Avr', 'Mai', 'Juin'],
          datasets: [{
            label: 'Dossiers traités',
            data: [45, 52, 48, 65, 59, 72],
            borderColor: '#3498db',
            backgroundColor: 'rgba(52, 152, 219, 0.1)',
            tension: 0.4,
            fill: true
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: { legend: { display: false } }
        }
      });

      const ctxType = document.getElementById('typeChart').getContext('2d');
      new Chart(ctxType, {
        type: 'doughnut',
        data: {
          labels: ['FCL', 'LCL'],
          datasets: [{
            data: [85, 42],
            backgroundColor: ['#3498db', '#e67e22']
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: { legend: { position: 'bottom' } }
        }
      });
    } catch (error) {
      console.error('Erreur:', error);
    }
  }

  document.addEventListener('DOMContentLoaded', loadData);
  setInterval(loadData, 30000);
</script>
{% endblock %}
